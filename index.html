<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>

  <script>
    const HashMap = () => {
      let map = [];
      let buckets = 16;

      // hashing function for a key

      const hash = (key) => {
        let hashCode = 0;

        const primeNumber = 31;
        for (let i = 0; i < key.length; i++) {
          hashCode = primeNumber * hashCode + key.charCodeAt(i);
        }

        return hashCode;
      };

      // set value
      const set = (key, val) => {
        let arrIndex = hash(key) % buckets;

        if (arrIndex < 0 || arrIndex >= buckets) {
          throw new Error("Trying to access index out of bound");
        }

        if (map[arrIndex] === undefined) {
          console.log("EMPTY!");
          map[arrIndex] = {
            key: key,
            value: val,
            next: null,
          };
        } else {
          let oldContent = { ...map[arrIndex] };
          map[arrIndex].value = val;
          map[arrIndex].key = key;
          map[arrIndex].next = oldContent;
          console.log(map);
        }

        return map;
      };

      // get value

      const get = (key) => {
        let arrIndex = hash(key) % buckets;

        if (arrIndex < 0 || arrIndex >= buckets) {
          throw new Error("Trying to access index out of bound");
        }

        if (map[arrIndex] === undefined) {
          return null;
        } else {
          checkLinkedList(map[arrIndex], key);
        }
      };

      // check if linked list contains the pair, if so print pair otherwise return null if not found
      const checkLinkedList = (node, key) => {
        if (key != node.key && node.next === null) {
          return null;
        } else if (key === node.key) {
          return console.log(node.value, node.key);
        } else {
          checkLinkedList(node.next, key);
        }
      };

      // checking if key is present
      const has = (key) => {
        let arrIndex = hash(key) % buckets;

        if (map[arrIndex] === undefined) {
          return null;
        } else {
          return { ...map[arrIndex] };
        }
      };
      // remove specific item from hash + LL
      const remove = (key) => {
        let arrIndex = hash(key) % buckets;

        if (arrIndex < 0 || arrIndex >= buckets) {
          throw new Error("Trying to access index out of bound");
        }

        if (map[arrIndex] === undefined) {
          return false;
        } else if ((map[arrIndex].next === null && map[arrIndex].key === key)) {
          console.log('test');
          return map[arrIndex] = null;
        } else {
          removeNodeFromLL(map[arrIndex], key);
        }
      };
      // recursively search through bucket and remove specific key
      const removeNodeFromLL = (node, key) => {
        if (key != node.key && node.next === null) {
          console.log("this idddf");
          return null;
        } else if (key === node.key) {
          console.log("matching first");
          let storeNext = { ...node.next };
          let arrIndex = hash(key) % buckets;
          map[arrIndex] = storeNext;
          return true;
        } else if (key === node.next.key) {
          console.log("this if");
          let storeNext;

          if (node.next.next === null) {
            storeNext = null;
          } else {
            storeNext = { ...node.next.next };
          }

          node.next = storeNext;
          console.log(map);
          return true;
        } else {
          return removeNodeFromLL(node.next, key);
        }
      };

      const length = () => {
        let counter = 0;
        for (x of map) {
          if (x != null) {
            counter += 1;
          }
        }
        return counter;
      };

      const clear = () => {
        map = [];
        return map;
      }
     // get all keys in hash map
      const keys = () => {
        for (x of map) {
          if (x != null){
            getKeys(x);
          }}};
     
    // go through LL and grab keys
      const getKeys = (node) => {
        console.log(node.key);
        if (node.next === null) {
          return console.log('End of list');
        } else {
          return getKeys(node.next);
        }
      };

      return {
        keys,
        clear,
        length,
        remove,
        has,
        get,
        map,
        hash,
        set,
      };
    };

    let myMap = HashMap();
    myMap.set("Sar", 1111);
    myMap.set("Sra", 333);
    myMap.set("raS", 2222);
    myMap.set("aSr", 555);
    console.log(myMap.get("raS"));

    console.log(myMap.has("Sar"));
    // console.log(myMap.remove("Sra"));
    console.log(myMap.map);
    console.log(myMap.length());
    // console.log(myMap.clear());
    myMap.keys();
    // console.log(myMap.map);

    // console.log(myHmap.map);
  </script>
</html>
